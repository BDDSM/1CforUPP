Перем ПараметрОповещения;

Процедура ПереключательОтображатьРабочиеДниПриИзменении(Элемент)
	УстановитьДоступность();
КонецПроцедуры

Процедура ГиперссылкаОткрытьКалендарьНажатие(Элемент)
	Форма = РегистрыСведений.РегламентированныйПроизводственныйКалендарь.ПолучитьФорму("Форма");
	Форма.Открыть();
КонецПроцедуры

Процедура УстановитьДоступность()
	флДоступностьГрафик = ИсточникСведенийОВыходныхДнях=2;
	ЭлементыФормы.График.Доступность = флДоступностьГрафик;
	ЭлементыФормы.График.АвтоОтметкаНезаполненного = флДоступностьГрафик;
	ЭлементыФормы.График.ОтметкаНезаполненного = флДоступностьГрафик и не ЗначениеЗаполнено(График);
КонецПроцедуры

Процедура УстановитьВидимостьНадписиКалендарь(флСообщать)
	флВидимость = не ПроизводственныйКалендарьЗаполнен(флСообщать);
	ЭлементыФормы.НадписьКалендарьНеЗаполнен.Видимость = флВидимость;
КонецПроцедуры

Процедура ПриОткрытии()
	УстановитьВидимостьНадписиКалендарь(ложь);
	УстановитьДоступность();
КонецПроцедуры

//Обработчик события ПриИзменении элемента формы флРежимРедактирования
Процедура флРежимРедактированияПриИзменении(Элемент)
	Если не флРежимРедактирования и мТаблицаИзменений.Количество()>0 Тогда
		ТекстИнформации = "Перед отключением режима редактирования необходимо сохранить внесенные изменения";
		Результат = ОткрытьФормуОтображенияИзменений(истина, ТекстИнформации);
		Если Результат = неопределено Тогда
			//отмена
			флРежимРедактирования = истина;
		Иначе
			//отказ от изменений либо запись изменений
			мТаблицаИзменений.Очистить();
			УбратьЖирныйШрифтТочекДиаграммы(ВладелецФормы.ЭлементыФормы.ДиаграммаГанта);
		КонецЕсли;
	КонецЕсли;
	УстановитьДоступность();
КонецПроцедуры

//Функция открывает вспомогательную форму, в которой отображаются внесенные изменения
//Возвращаемые значения:
//	Истина 	- изменения сохранены
//	Ложь 	- указание пользователя "не сохранять изменения"
//	Неопределено - отмена выполнения текущего действия 
Функция ОткрытьФормуОтображенияИзменений(флРежимОтказаОтСохранения, ТекстИнформации)
	ФормаОтображенияИзменений = ПолучитьФорму("ФормаОтображениеИзменений");
	ФормаОтображенияИзменений.мТаблицаИзменений = мТаблицаИзменений;
	ФормаОтображенияИзменений.ДопПараметры = новый Структура("флРежимОтказаОтСохранения,ТекстИнформации",флРежимОтказаОтСохранения,ТекстИнформации);

	Возврат ФормаОтображенияИзменений.ОткрытьМодально(600);

КонецФункции


Процедура ПриЗакрытии()
	Оповестить("ГрафикЗаказов_ЗакрытаФормаНастройки",ПараметрОповещения);
КонецПроцедуры

Процедура КоманднаяПанельДействияФормыОтмена(Кнопка)
	ПараметрОповещения = ложь;
	ЭтаФорма.Закрыть();
КонецПроцедуры

Процедура КоманднаяПанельДействияФормыОК(Кнопка)
	ПараметрОповещения = истина;
	ЭтаФорма.Закрыть();
КонецПроцедуры