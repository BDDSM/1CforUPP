Перем мИсходноеЗначениеАвтоматическийОбменДанными;

Перем МодифицированностьПередЗаписью; // Устанавливается в событии ПередЗаписью


///////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ И ФУНКЦИИ ОБЩЕГО НАЗНАЧЕНИЯ

Процедура СписокРазделовПриАктивизацииСтроки(Элемент)
	
	ТекущйийРаздел = ЭлементыФормы.СписокРазделов.ТекущаяСтрока;
	ЭлементыФормы.ПанельРазделов.ТекущаяСтраница = ЭлементыФормы.ПанельРазделов.Страницы[ТекущйийРаздел.ИмяРаздела];
	
КонецПроцедуры

Процедура ЗаполнитьИсходныеЗначенияКонстант()

	мИсходноеЗначениеАвтоматическийОбменДанными = ИспользоватьМеханизмАвтоматическогоОбменаДанными;
	
КонецПроцедуры //

Процедура СообщитьОбИзмененииПараметровУчета()
	
	МассивСоединений = ПолучитьСоединенияИнформационнойБазы() ;
	Для Каждого ТекСоединение Из МассивСоединений Цикл
		Если (ТекСоединение.ИмяПриложения = "1CV8") 
		   И (НЕ ТекСоединение.НомерСоединения = НомерСоединенияИнформационнойБазы())
		   И (НЕ ТекСоединение.Пользователь = неопределено) Тогда
			  
				ОбщегоНазначения.Сообщение("Внимание! Вы изменили настройки параметров учета!
						 |В настоящий момент в базе работают пользователи. 
						 |Некоторые настройки могут не начать действовать для них.
						 |Им необходимо перезапустить программу. 
						 |Для Вас новые настройки уже вступили в силу, перезапускать программу не требуется.", СтатусСообщения.Важное);
				Прервать;		 
		КонецЕсли;
	КонецЦикла;			
	
КонецПроцедуры

Процедура ПрефиксУзлаРаспределеннойИнформационнойБазыПриИзменении(Элемент)
	
	ПроцедурыОбменаДаннымиКлиент.ОбработатьИзменениеПрефиксаДляОбъектов(Элемент);
	
КонецПроцедуры

Процедура ЗаполнитьСписокРазделов()
	
	ОбработкаОбъект.ДобавитьРаздел(СписокРазделов, "ОбменДанными", "Обмен данными", 1);
	ОбработкаОбъект.ДобавитьРаздел(СписокРазделов, "ОбменЮНИСКАН", "Обмен с БД ЮНИСКАН", 1);
	
КонецПроцедуры // ЗаполнитьСписокРазделов


////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ ПЕЧАТИ

Процедура ОсновныеДействияФормыПечать(Кнопка)
	
	Результат = Истина;

	Если ЭтаФорма.Модифицированность Тогда

		Ответ = Вопрос("Настройки изменены. Для печати необходимо записать настройки.
		               |Записать?",
		               РежимДиалогаВопрос.ОКОтмена, , 
		               КодВозвратаДиалога.Отмена,
		               "Печать");

		Если Ответ = КодВозвратаДиалога.ОК Тогда

			Попытка
				
				Результат = ЗаписатьВФорме();				
				
			Исключение
				Результат = Ложь;
			КонецПопытки;	

		КонецЕсли;

	КонецЕсли;

	Если Результат Тогда
		ОбработкаОбъект.Печать(СписокРазделов, "Настройка обмена данными");
	КонецЕсли; 
	
КонецПроцедуры


////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ - ОБРАБОТЧИКИ СОБЫТИЙ ФОРМЫ

Процедура ПриОткрытии()
	
	ЗаполнитьИсходныеЗначенияКонстант();
	ЗаполнитьСписокРазделов();
	
КонецПроцедуры

Процедура ПередЗаписью(Отказ)
	
	МодифицированностьПередЗаписью = Модифицированность;
	
КонецПроцедуры

Процедура ПослеЗаписи()
	
	// при изменении константы автоматического обмена данными надо обновить список обмена данными
	Если ИспользоватьМеханизмАвтоматическогоОбменаДанными <> мИсходноеЗначениеАвтоматическийОбменДанными
		И глЗначениеПеременной("глОбработкаАвтоОбменДанными") <> Неопределено Тогда
		
		глЗначениеПеременной("глОбработкаАвтоОбменДанными").ОбновитьТабличнуюЧастьАвтоматическихОбменов();
	КонецЕсли;
	
	Если МодифицированностьПередЗаписью Тогда
		СообщитьОбИзмененииПараметровУчета();
		МодифицированностьПередЗаписью = Ложь;
	КонецЕсли;
	
	ЗаполнитьИсходныеЗначенияКонстант();
	
КонецПроцедуры