// ИНТЕРФЕЙСНАЯ ЧАСТЬ ПЕРЕОПРЕДЕЛЯЕМОГО МОДУЛЯ

// Возвращает список процедур-обработчиков обновления ИБ для всех поддерживаемых версий ИБ.
//
// Пример добавления процедуры-обработчика в список:
//    Обработчик = Обработчики.Добавить();
//    Обработчик.Версия = "1.0.0.0";
//    Обработчик.Процедура = "ОбновлениеИБ.ПерейтиНаВерсию_1_0_0_0";
//
// Вызывается перед началом обновления данных ИБ.
//
Функция ОбработчикиОбновления() Экспорт
	
	Обработчики = ОбновлениеИнформационнойБазы.НоваяТаблицаОбработчиковОбновления();
	
	// Библиотеки УПП и ЗУП
	Обработчик = Обработчики.Добавить();
	Обработчик.Версия    	= "*";
	Обработчик.Процедура 	= "БиблиотекаОбновленияИнформационнойБазы.ВыполнитьОбновлениеИнформационнойБазы";
	
	// Библиотеки обмена ЭД
	Обработчик = Обработчики.Добавить();
	Обработчик.Версия    	= "*";
	Обработчик.Процедура 	= "ЭлектронныеДокументы.ВыполнитьОбновлениеИнформационнойБазы";
	
	// При создании новой базы
	Обработчик = Обработчики.Добавить();
	Обработчик.Версия    	= "1.3.1.1";
	Обработчик.Процедура    = "Справочники.СпособыРаспределенияЗатратНаВыпуск.ЗаполнитьСпособыРаспределенияПоУмолчанию";
	
	// Версия 1.3.23
	Обработчик = Обработчики.Добавить();
	Обработчик.Версия       = "1.3.23.1";
	Обработчик.Процедура    = "Справочники.СпособыРаспределенияЗатратНаВыпуск.ЗаполнитьСпособыРаспределенияПоУмолчанию";
	Обработчик.Опциональный = Истина; //Вызывается явно при заполнении новой базы

	Обработчик = Обработчики.Добавить();
	Обработчик.Версия       = "1.3.23.1";
	Обработчик.Процедура    = "Справочники.СпособыРаспределенияЗатратНаВыпуск.ЗаполнитьЗначенияРеквизитовПоУмолчанию";
	Обработчик.Опциональный = Истина; // В новой базе не требуется, вызывается для способов распределения, добавленных пользователями
	
	Обработчик = Обработчики.Добавить();
	Обработчик.Версия       = "1.3.23.1";
	Обработчик.Процедура    = "БиблиотекаОбновленияИнформационнойБазыПереопределяемый.УстановитьКонстантуНастройкиСпособовРаспределенияЗатрат";
	Обработчик.Опциональный = Истина; // В новой базе не требуется - по умолчанию будут использоваться новые способы распределения
	
	// Версия 1.3.24.1
	Обработчик = Обработчики.Добавить();
	Обработчик.Версия       = "1.3.24.1";
	Обработчик.Процедура    = "Справочники.СпособыРаспределенияЗатратНаВыпуск.ЗаполнитьСпособыРаспределенияПоУмолчанию";
	Обработчик.Опциональный = Истина; // В новой базе не требуется - вызывается явно при заполнении новой базы
	
	// Версия 1.3.24.2
	Обработчик = Обработчики.Добавить();
	Обработчик.Версия       = "1.3.24.2";
	Обработчик.Процедура    = "БиблиотекаОбновленияИнформационнойБазыПереопределяемый.ИзменитьНастройкуВыгрузкиСебестоимостиВРозницу";
	Обработчик.Опциональный = Истина; // В новой базе не требуется
	
	// Версия 1.3.25.1
	Обработчик = Обработчики.Добавить();
	Обработчик.Версия       = "1.3.25.1";
	Обработчик.Процедура    = "Справочники.СпособыРаспределенияЗатратНаВыпуск.ЗаполнитьСпособыРаспределенияПоУмолчанию";
	Обработчик.Опциональный = Истина; // В новой базе не требуется - вызывается явно при заполнении новой базы
	
	// Версия 1.3.28.1
	Обработчик = Обработчики.Добавить();
	Обработчик.Версия       = "1.3.28.1";
	Обработчик.Процедура    = "Справочники.СпособыРаспределенияЗатратНаВыпуск.ЗаполнитьСпособыРаспределенияПоУмолчанию";
	Обработчик.Опциональный = Истина; // В новой базе не требуется - вызывается явно при заполнении новой базы
	
	// Версия 1.3.29.1
	Обработчик = Обработчики.Добавить();
	Обработчик.Версия       = "1.3.29.1";
	Обработчик.Процедура    = "Справочники.СпособыРаспределенияЗатратНаВыпуск.ОбновитьСпособМатериальныеЗатраты";
	Обработчик.Опциональный = Истина;
	
	Возврат Обработчики;
	
КонецФункции

///////////////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ ОБРАБОТКИ ДАННЫХ, НАКОПЛЕННЫХ В ИНФОРМАЦИОННОЙ БАЗЕ ("ОПЦИОНАЛЬНЫЕ")

Процедура УстановитьКонстантуНастройкиСпособовРаспределенияЗатрат() Экспорт
	
	Константы.ИспользоватьГибкуюНастройкуСпособовРаспределенияЗатрат.Установить(Истина);
	
КонецПроцедуры

Процедура ИзменитьНастройкуВыгрузкиСебестоимостиВРозницу() Экспорт
	
	ВыборкаУзлов = ПланыОбмена.ОбменУправлениеПредприятиемРозничнаяТорговля.Выбрать();
	
	Пока ВыборкаУзлов.Следующий() Цикл
		
		УзелОбмена = ВыборкаУзлов.ПолучитьОбъект();
		
		Если УзелОбмена.УдалитьВыгружатьСебестоимость Тогда
			УзелОбмена.СпособВыгрузкиСебестоимости = Перечисления.СпособыВыгрузкиСебестоимостиВРозничнуюТорговлю.ВыгружатьСебестоимостьРегл;
		Иначе
			УзелОбмена.СпособВыгрузкиСебестоимости = Перечисления.СпособыВыгрузкиСебестоимостиВРозничнуюТорговлю.НеВыгружать;
		КонецЕсли;
		
		УзелОбмена.Записать();
		
	КонецЦикла;
	
КонецПроцедуры