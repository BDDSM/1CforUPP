//  Процедура печатает выбранный документ 
// Печатается та форма, которая была отпечатана при нажатии в документе кнопки
// печати по умолчанию
//
Процедура ДействияФормыДействиеПечать(Кнопка)

	Если ЭтаФорма.ЭлементыФормы.Список.ТекущаяСтрока = Неопределено тогда
		Возврат
	КонецЕсли;

	УниверсальныеМеханизмы.НапечататьДокументИзФормыСписка(ЭтаФорма.ЭлементыФормы.Список.ТекущаяСтрока.ПолучитьОбъект());

КонецПроцедуры // ДействиеПечать()

// Процедура вызывается при выборе пункта подменю "Движения документа по регистрам" меню "Перейти".
// командной панели формы. Процедура отрабатывает печать движений документа по регистрам.
//
Процедура ДействияФормыДвиженияДокументаПоРегистрам(Кнопка)

	Если ЭтаФорма.ЭлементыФормы.Список.ТекущаяСтрока = Неопределено тогда
		Возврат
	КонецЕсли;

	РаботаСДиалогами.НапечататьДвиженияДокумента(ЭлементыФормы.Список.ТекущиеДанные.Ссылка);

КонецПроцедуры // ДействияФормыДвиженияДокументаПоРегистрам()

// Процедура вызывается при выборе пункта подменю "Структура подчиненности" меню "Перейти".
Процедура ДействияФормыСтруктураПодчиненностиДокумента(Кнопка)
	
	Если ЭлементыФормы.Список.ТекущиеДанные = Неопределено тогда
		Возврат
	КонецЕсли;
	
	РаботаСДиалогами.ПоказатьСтруктуруПодчиненностиДокумента(ЭлементыФормы.Список.ТекущиеДанные.Ссылка);
	
КонецПроцедуры

Процедура ДействияФормыДействиеАнализ(Кнопка)
	Если ЭлементыФормы.Список.ТекущиеДанные = Неопределено тогда
		Возврат
	КонецЕсли;
	УправлениеЗаказами.СформироватьОтчетАнализЗаказа(ЭлементыФормы.Список.ТекущиеДанные.Ссылка.ВнутреннийЗаказ,истина, истина);

КонецПроцедуры

Процедура СписокПриПолученииДанных(Элемент, ОформленияСтрок)
	
	Если НЕ ЭлементыФормы.Список.Колонки.ВидЗаказа.Видимость 
		И НЕ ЭлементыФормы.Список.Колонки.Заказчик.Видимость Тогда
		
		Возврат;
	КонецЕсли;
	
	МассивДокументов = Новый Массив;
	Соответствие = Новый Соответствие;
	Для каждого Строка из ОформленияСтрок цикл
		СсылкаНаДокумент = Строка.ДанныеСтроки.ВнутреннийЗаказ;
		МассивДокументов.Добавить(СсылкаНаДокумент);
		Соответствие.Вставить(СсылкаНаДокумент, Строка);
	КонецЦикла;
	
	Запрос = Новый Запрос;
	ТекстЗапроса = "ВЫБРАТЬ
	               |	ВнутреннийЗаказ.ВидЗаказа,
	               |	ВнутреннийЗаказ.Заказчик.Представление КАК Заказчик,
	               |	ВнутреннийЗаказ.Ссылка
	               |ИЗ
	               |	Документ.ВнутреннийЗаказ КАК ВнутреннийЗаказ
	               |ГДЕ
	               |	ВнутреннийЗаказ.Ссылка В(&МассивДокументов)";
	 
	Запрос.Текст = ТекстЗапроса;
	Запрос.УстановитьПараметр("МассивДокументов", МассивДокументов);
	
	Результат = Запрос.Выполнить();
	Выборка = Результат.Выбрать();
	
	Пока Выборка.Следующий() Цикл
		Соответствие.Получить(Выборка.Ссылка).Ячейки.ВидЗаказа.УстановитьТекст(Выборка.ВидЗаказа);
		Соответствие.Получить(Выборка.Ссылка).Ячейки.Заказчик.УстановитьТекст(Выборка.Заказчик);
	КонецЦикла;	
	
КонецПроцедуры

Процедура ПередОткрытием(Отказ, СтандартнаяОбработка)
	Отказ = Не УправлениеЗаказами.ИспользоватьВнутренниеЗаказы(Истина);
КонецПроцедуры