Перем ОписаниеТиповСтрока;
Перем ЛинияОбластиВставки;

Процедура УстановитьТекстЯчейки(ТекстЯчейки)

	ОбластьВставки=ЭлементыФормы.ПолеФормулы.ТекущаяОбласть;
	ОбластьВставки.ШиринаКолонки=СтрДлина(ТекстЯчейки);
	
	ОбластьВставки.Текст=ТекстЯчейки;	
    НоваяОбластьВставки=ЭлементыФормы.ПолеФормулы.Область(1,ОбластьВставки.Лево+1);
    НоваяОбластьВставки.ШиринаКолонки=?(СтрДлина(НоваяОбластьВставки.Текст)=0,1,?(СтрДлина(НоваяОбластьВставки.Текст)=1,3,СтрДлина(НоваяОбластьВставки.Текст)));
	НоваяОбластьВставки.ГоризонтальноеПоложение=ГоризонтальноеПоложение.Центр;	
	ЭлементыФормы.ПолеФормулы.ТекущаяОбласть=ЭлементыФормы.ПолеФормулы.Область(1,ОбластьВставки.Лево+1);	

КонецПроцедуры // УстановитьТекстЯчейки()

Процедура ЗаполнитьТаблицуИспользуемыхСтрок(КоллекцияСтрок, ТаблицаИспользуемыхСтрок);

	Для каждого Строка Из КоллекцияСтрок Цикл

		Для Индекс=1 По ЭлементыФормы.ПолеФормулы.ШиринаТаблицы Цикл

			ОбластьФормулы=ЭлементыФормы.ПолеФормулы.Область(1,Индекс);

			Если ОбластьФормулы.Текст="["+Строка.Код+"]" Тогда

				ИспользуемаяСтрока=ТаблицаИспользуемыхСтрок.Добавить();		
				ИспользуемаяСтрока.СтрокаРасчета=Строка.СтрокаРасчета;

			КонецЕсли;

		КонецЦикла;

	КонецЦикла;

КонецПроцедуры // ЗаполнитьТаблицуИспользуемыхСтрок()
 

Процедура КнопкаОкНажатие(Элемент)

	Если ЭлементыФормы.КоманднаяПанельПолеФормулы.Кнопки.КодНаименование.Пометка Тогда // Заменим представления на коды

		ЗаменитьКодПредставление(ТаблицаАргументы);

	КонецЕсли;

	ТекстФормулы="";

	Для Индекс=1 по ЭлементыФормы.ПолеФормулы.ШиринаТаблицы Цикл

		ТекстЯчейки=СокрЛП(ЭлементыФормы.ПолеФормулы.Область(1,Индекс).Текст);

		Если ТекстЯчейки <> "" Тогда 
			ТекстФормулы=ТекстФормулы+ТекстЯчейки;
		КонецЕсли;

	КонецЦикла;

	ТаблицаИспользуемыхСтрок=Новый ТаблицаЗначений;
	ТаблицаИспользуемыхСтрок.Колонки.Добавить("СтрокаРасчета");

	ЗаполнитьТаблицуИспользуемыхСтрок(ТаблицаАргументы,ТаблицаИспользуемыхСтрок);

	СтруктураФормулы=Новый Структура;
	СтруктураФормулы.Вставить("Текст",ТекстФормулы);
	СтруктураФормулы.Вставить("СтрокиРасчета",ТаблицаИспользуемыхСтрок);

	ОповеститьОВыборе(СтруктураФормулы);

КонецПроцедуры

Процедура КнопкаПлюсНажатие(Элемент)
	
    УстановитьТекстЯчейки("+");
	
КонецПроцедуры

Процедура КнопкаМинусНажатие(Элемент)

  	УстановитьТекстЯчейки("-");
	
КонецПроцедуры

Процедура ТаблицаАргументыВыбор(Элемент, ВыбраннаяСтрока, Колонка, СтандартнаяОбработка)
	
	Если ЭлементыФормы.КоманднаяПанельПолеФормулы.Кнопки.КодНаименование.Пометка Тогда
		УстановитьТекстЯчейки("["+ВыбраннаяСтрока.СтрокаРасчета+"]");
	Иначе	
    	УстановитьТекстЯчейки("["+ВыбраннаяСтрока.Код+"]");
	КонецЕсли;

	ЭлементыФормы.ПолеФормулы.Показать();
	
КонецПроцедуры

Процедура КнопкаРаздвинутьНажатие(Элемент)
	
	ЭлементыФормы.ПолеФормулы.ВставитьОбласть(ЭлементыФормы.ПолеФормулы.ТекущаяОбласть,,ТипСмещенияТабличногоДокумента.ПоГоризонтали);

    Для Индекс=1 по ЭлементыФормы.ПолеФормулы.ШиринаТаблицы Цикл

		ЭлементыФормы.ПолеФормулы.Область(1,Индекс).ШиринаКолонки=СтрДлина(ЭлементыФормы.ПолеФормулы.Область(1,Индекс).Текст)

	КонецЦикла;

	ЭлементыФормы.ПолеФормулы.ТекущаяОбласть=ЭлементыФормы.ПолеФормулы.Область(1,ЭлементыФормы.ПолеФормулы.ТекущаяОбласть.Лево+1);
    ЭлементыФормы.ПолеФормулы.ТекущаяОбласть.Текст=" ";
	ЭлементыФормы.ПолеФормулы.ТекущаяОбласть.ШиринаКолонки=1;
	ЭлементыФормы.ПолеФормулы.ТекущаяОбласть.ГоризонтальноеПоложение=ГоризонтальноеПоложение.Центр;
   
КонецПроцедуры

Процедура КнопкаУдалитьНажатие(Элемент)

	ЭлементыФормы.ПолеФормулы.УдалитьОбласть(ЭлементыФормы.ПолеФормулы.ТекущаяОбласть,ТипСмещенияТабличногоДокумента.ПоГоризонтали);

    Для Индекс=1 по ЭлементыФормы.ПолеФормулы.ШиринаТаблицы Цикл

		ЭлементыФормы.ПолеФормулы.Область(1,Индекс).ШиринаКолонки=СтрДлина(ЭлементыФормы.ПолеФормулы.Область(1,Индекс).Текст)

	КонецЦикла;
	
КонецПроцедуры

Процедура ПолеФормулыПриАктивизацииОбласти(Элемент)

	Если Элемент.ТекущаяОбласть.Низ>1 Тогда

		Элемент.ТекущаяОбласть=Элемент.Область(1,Элемент.ТекущаяОбласть.Лево);

	КонецЕсли;
	
	Для Индекс=1 по Элемент.ШиринаТаблицы Цикл

		Элемент.Область(1,Индекс).ЦветФона=Новый Цвет(255,255,255);

	КонецЦикла;

	Элемент.ТекущаяОбласть.ЦветФона=Новый Цвет(234,229,216);
			
КонецПроцедуры

Процедура ПриОткрытии()
	
	ЭлементыФормы.КоманднаяПанельПолеФормулы.Кнопки.КодНаименование.Пометка=Ложь;
		
КонецПроцедуры

Процедура КнопкаУмножитьНажатие(Элемент)
	
	УстановитьТекстЯчейки("*");

КонецПроцедуры

Процедура КнопкаРазделитьНажатие(Элемент)

	УстановитьТекстЯчейки("/");

КонецПроцедуры

Процедура КнопкаСкобкаОткрытьНажатие(Элемент)

	УстановитьТекстЯчейки("(");
	
КонецПроцедуры

Процедура КнопкаСкобкаЗакрытьНажатие(Элемент)
	
	УстановитьТекстЯчейки(")");

КонецПроцедуры

Процедура КнопкаШагВлевоНажатие(Элемент)
	
	Если ЭлементыФормы.ПолеФормулы.ТекущаяОбласть.Лево>1 Тогда

		ЭлементыФормы.ПолеФормулы.ТекущаяОбласть=ЭлементыФормы.ПолеФормулы.Область(1,ЭлементыФормы.ПолеФормулы.ТекущаяОбласть.Лево-1);

    КонецЕсли;
	
КонецПроцедуры

Процедура КнопкаШагВправоНажатие(Элемент)

	ЭлементыФормы.ПолеФормулы.ТекущаяОбласть=ЭлементыФормы.ПолеФормулы.Область(1,ЭлементыФормы.ПолеФормулы.ТекущаяОбласть.Лево+1);

КонецПроцедуры

Процедура ЗаменитьКодПредставление(КоллекцияСтрок);

	Для каждого Строка Из КоллекцияСтрок Цикл

		Для Индекс=1 По ЭлементыФормы.ПолеФормулы.ШиринаТаблицы Цикл

			ОбластьФормулы=ЭлементыФормы.ПолеФормулы.Область(1,Индекс);

			Если ОбластьФормулы.Текст="["+Строка.Код+"]" Тогда
				
                ОбластьФормулы.ШиринаКолонки=СтрДлина("["+СокрЛП(Строка.СтрокаРасчета)+"]");
				ОбластьФормулы.Текст="["+СокрЛП(Строка.СтрокаРасчета)+"]";

			ИначеЕсли ОбластьФормулы.Текст="["+СокрЛП(Строка.СтрокаРасчета)+"]" Тогда

				ОбластьФормулы.ШиринаКолонки=СтрДлина("["+Строка.Код+"]");
				ОбластьФормулы.Текст="["+Строка.Код+"]";

			КонецЕсли;
			
		КонецЦикла;

	КонецЦикла;

КонецПроцедуры // ЗаменитьКодПредставление()

Процедура КодНаименованиеНажатие(Элемент)

	ЗаменитьКодПредставление(ТаблицаАргументы);
	ЭлементыФормы.КоманднаяПанельПолеФормулы.Кнопки.КодНаименование.Пометка=Не ЭлементыФормы.КоманднаяПанельПолеФормулы.Кнопки.КодНаименование.Пометка;	

КонецПроцедуры

Процедура КоманднаяПанельПолеФормулыСтеретьСлева(Кнопка)
	
    Колонка=ЭлементыФормы.ПолеФормулы.ТекущаяОбласть.Лево;

	Если Колонка>1 Тогда

		ОбластьУдаления=ЭлементыФормы.ПолеФормулы.Область(1,Колонка-1);
		ЭлементыФормы.ПолеФормулы.УдалитьОбласть(ОбластьУдаления,ТипСмещенияТабличногоДокумента.ПоГоризонтали);

		Для Индекс=1 по ЭлементыФормы.ПолеФормулы.ШиринаТаблицы Цикл

			ЭлементыФормы.ПолеФормулы.Область(1,Индекс).ШиринаКолонки=СтрДлина(ЭлементыФормы.ПолеФормулы.Область(1,Индекс).Текст);

		КонецЦикла;

		ЭлементыФормы.ПолеФормулы.ТекущаяОбласть=ЭлементыФормы.ПолеФормулы.Область(1,Колонка-1);
		ЭлементыФормы.ПолеФормулы.ТекущаяОбласть.ШиринаКолонки=?(СтрДлина(ЭлементыФормы.ПолеФормулы.ТекущаяОбласть.Текст)=0,1,СтрДлина(ЭлементыФормы.ПолеФормулы.ТекущаяОбласть.Текст));
		ЭлементыФормы.ПолеФормулы.ТекущаяОбласть.ГоризонтальноеПоложение=ГоризонтальноеПоложение.Центр;

	КонецЕсли;
		
КонецПроцедуры

Процедура ПередОткрытием(Отказ, СтандартнаяОбработка)

	ЭлементыФормы.ТаблицаАргументы.Значение = НачальноеЗначениеВыбора.ТаблицаСтрок;

	ТекстИсходный=СокрЛП(НачальноеЗначениеВыбора.Текст);
	КоличествоСимволов=СтрДлина(ТекстИсходный);

	Если КоличествоСимволов>0 Тогда

		ТекстЯчейки="";

		Для Индекс=1 По КоличествоСимволов Цикл

			ТекСимвол=Сред(ТекстИсходный,Индекс,1);

			Если ТекСимвол="[" Тогда  // Формируем текст аргумента расчета

				ТекстЯчейки=ТекстЯчейки+ТекСимвол;

			ИначеЕсли ТекСимвол="]" Тогда // Устанавливаем текст аргумента расчета


				ТекстЯчейки=ТекстЯчейки+ТекСимвол;
				УстановитьТекстЯчейки(ТекстЯчейки);
				ТекстЯчейки="";

			Иначе

				Если ТекстЯчейки="" Тогда // Устанавливаем операнд расчета

					УстановитьТекстЯчейки(ТекСимвол);

				Иначе // Формируем текст аргумента расчета

					ТекстЯчейки=ТекстЯчейки+ТекСимвол;

				КонецЕсли;

			КонецЕсли;

		КонецЦикла;

	Иначе

		ОбластьВставки=ЭлементыФормы.ПолеФормулы.Область(1,1);
		ОбластьВставки.ШиринаКолонки=1;
		ОбластьВставки.ГоризонтальноеПоложение=ГоризонтальноеПоложение.Центр;

		ЭлементыФормы.ПолеФормулы.ТекущаяОбласть=ОбластьВставки;

	КонецЕсли;

КонецПроцедуры

Процедура КоманднаяПанельПолеФормулыКнопкаУсловие(Кнопка)
	
	УстановитьТекстЯчейки("?");
	
КонецПроцедуры

Процедура КоманднаяПанельПолеФормулыКнопкаМеньше(Кнопка)
	
	УстановитьТекстЯчейки("<");
	
КонецПроцедуры

Процедура КоманднаяПанельПолеФормулыКнопкаРавно(Кнопка)
		
	УстановитьТекстЯчейки("=");
	
КонецПроцедуры

Процедура КоманднаяПанельПолеФормулыКнопкаБольше(Кнопка)
		
	УстановитьТекстЯчейки(">");
	
КонецПроцедуры

Процедура КоманднаяПанельПолеФормулыКнопкаМин(Кнопка)
			
	УстановитьТекстЯчейки("Мин");
	
КонецПроцедуры

Процедура КоманднаяПанельПолеФормулыКнопкаМакс(Кнопка)
					
	УстановитьТекстЯчейки("Макс");
		
КонецПроцедуры

Процедура КоманднаяПанельПолеФормулыКнопка1(Кнопка)
					
	УстановитьТекстЯчейки("1");
		
КонецПроцедуры

Процедура КоманднаяПанельПолеФормулыКнопка2(Кнопка)
						
	УстановитьТекстЯчейки("2");

КонецПроцедуры

Процедура КоманднаяПанельПолеФормулыКнопка3(Кнопка)
						
	УстановитьТекстЯчейки("3");

КонецПроцедуры

Процедура КоманднаяПанельПолеФормулыКнопка4(Кнопка)
						
	УстановитьТекстЯчейки("4");

КонецПроцедуры

Процедура КоманднаяПанельПолеФормулыКнопка5(Кнопка)
						
	УстановитьТекстЯчейки("5");

КонецПроцедуры

Процедура КоманднаяПанельПолеФормулыКнопка6(Кнопка)
						
	УстановитьТекстЯчейки("6");
	
КонецПроцедуры

Процедура КоманднаяПанельПолеФормулыКнопка7(Кнопка)
						
	УстановитьТекстЯчейки("7");

КонецПроцедуры

Процедура КоманднаяПанельПолеФормулыКнопка8(Кнопка)
						
	УстановитьТекстЯчейки("8");

КонецПроцедуры

Процедура КоманднаяПанельПолеФормулыКнопка9(Кнопка)
						
	УстановитьТекстЯчейки("9");

КонецПроцедуры

Процедура КоманднаяПанельПолеФормулыКнопка0(Кнопка)
						
	УстановитьТекстЯчейки("0");

КонецПроцедуры

Процедура КоманднаяПанельПолеФормулыКнопка_(Кнопка)
						
	УстановитьТекстЯчейки(",");

КонецПроцедуры

Процедура КоманднаяПанельПолеФормулыКнопкаТочка(Кнопка)
	
	УстановитьТекстЯчейки(".");
	
КонецПроцедуры