////////////////////////////////////////////////////////////////////////////////
// ПЕРЕМЕННЫЕ МОДУЛЯ

// Определяет, из какой таблицы главной формы отчета была вызвана форма.
Перем ИсходнаяТаблица;

////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ И ФУНКЦИИ ОБЩЕГО НАЗНАЧЕНИЯ 

// Процедура передает сделанные настройки в главную форму отчета.
//
Процедура Выбрать()

	ОписаниеТиповСтрока = Новый ОписаниеТипов("Строка",, Новый КвалификаторыСтроки(200));
	МассивБулево = Новый Массив;
	МассивБулево.Добавить(Тип("Булево"));
	ОписаниеТиповБулево = Новый ОписаниеТипов(МассивБулево);

	ВыбранныеСтроки = Новый ТаблицаЗначений;
	ВыбранныеСтроки.Колонки.Добавить("Регистр", 		ОписаниеТиповСтрока);
	ВыбранныеСтроки.Колонки.Добавить("ИмяПоля",   ОписаниеТиповСтрока);
	ВыбранныеСтроки.Колонки.Добавить("ПредставлениеПоля",   ОписаниеТиповСтрока);

	Если ЭлементыФормы.Дерево.ТекущаяСтрока <> Неопределено Тогда

		СтрТабличноеПоле = ЭлементыФормы.Дерево.ТекущиеДанные;

		НоваяСтрока = ВыбранныеСтроки.Добавить();
		НоваяСтрока.Регистр					= СтрТабличноеПоле.Регистр;
		НоваяСтрока.ПредставлениеПоля		= СтрТабличноеПоле.ПредставлениеПоля;
		НоваяСтрока.ИмяПоля	 				= СтрТабличноеПоле.ИмяПоля; 

	КонецЕсли;

	ОповеститьОВыборе(ВыбранныеСтроки);

КонецПроцедуры // Выбрать()

///////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ

// Процедура - обработчик события "При открытии" формы.
//
Процедура ПриОткрытии()

	СтруктураПараметров = НачальноеЗначениеВыбора;

	ИсходнаяТаблица="";

	// Все возможные группировки в виде дерева значений
	ДеревоИспользуемыеЗначения = СтруктураПараметров.ДеревоЗначенийДляВыбора.Скопировать();

	Заголовок="Данные источника";

	ЭлементыФормы.Дерево.Значение = ДеревоИспользуемыеЗначения ;
		
КонецПроцедуры // ПриОткрытии()

// Процедура - обработчик попытки удаления строки из таблицы.
//
Процедура ДеревоПередУдалением(Элемент, Отказ)

	Отказ = Истина;

КонецПроцедуры // ТабличноеПолеПередУдалением()

// Процедура - обработчик выбора строки таблицы.
//
Процедура ДеревоВыбор(Элемент, ВыбраннаяСтрока, Колонка, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;

	Если Элемент.ТекущаяСтрока.Строки.Количество()=0 Тогда	

		Выбрать();

	КонецЕсли;

КонецПроцедуры // ТабличноеПолеВыбор()

// Процедура - обработчик попытки добавления строки в таблицу.
//
Процедура ДеревоПередНачаломДобавления(Элемент, Отказ, Копирование)

	Отказ = Истина;

КонецПроцедуры // ТабличноеПолеПередНачаломДобавления()

Процедура КнопкаОкНажатие(Кнопка)
	
    Если ЭлементыФормы.Дерево.ТекущаяСтрока.Строки.Количество()=0 Тогда

	   Выбрать();

	КонецЕсли;
	
КонецПроцедуры