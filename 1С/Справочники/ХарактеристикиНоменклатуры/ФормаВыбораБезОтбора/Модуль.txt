////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ ЭЛЕМЕНТОВ УПРАВЛЕНИЯ

Процедура ХарактеристикиПриАктивизацииСтроки(Элемент)
	
	Если Элемент.ТекущиеДанные = Неопределено Тогда
		
		СвойстваИЗначения.Очистить();
	Иначе
		
		Запрос = Новый Запрос(
		"ВЫБРАТЬ 
		|	ЗначенияСвойствОбъектов.Свойство,
		|	ЗначенияСвойствОбъектов.Значение
		|ИЗ
		|	РегистрСведений.ЗначенияСвойствОбъектов КАК ЗначенияСвойствОбъектов
		|ГДЕ
		|	ЗначенияСвойствОбъектов.Объект = &Объект"
		);
		Запрос.УстановитьПараметр("Объект", Элемент.ТекущиеДанные.Ссылка);
		
		СвойстваИЗначения = Запрос.Выполнить().Выгрузить();
		
	КонецЕсли;
	
КонецПроцедуры

Процедура ПередОткрытием(Отказ, СтандартнаяОбработка)
	
	Если РежимВыбора И НЕ ЗначениеЗаполнено(ПараметрВыборПоВладельцу) 
	  И ЭтаФорма.ВладелецФормы <> Неопределено
	  И ТипЗНЧ(ЭтаФорма.ВладелецФормы) = Тип("ПолеВвода")
	  И НЕ ЗначениеЗаполнено(ЭтаФорма.ВладелецФормы.ВыборПоВладельцу)
	  И ТипЗНЧ(ЭтаФорма.ВладелецФормы.ВыборПоВладельцу) = Тип("СправочникСсылка.Номенклатура") Тогда
		Предупреждение("Не выбрана номенклатура!");
		Отказ = Истина;
		Возврат;  
	Иначе
		Если РежимВыбора И НЕ ЗначениеЗаполнено(ПараметрВыборПоВладельцу) Тогда
			ФормаВыбораВладельца = Справочники.Номенклатура.ПолучитьФормуВыбора();
			ФормаВыбораВладельца.Заголовок = "Выберите элемент справочника Номенклатура, Характеристики которого Вы хотите выбирать.";
			ПараметрВыборПоВладельцу = ФормаВыбораВладельца.ОткрытьМодально();
		КонецЕсли;
		
		Если ЗначениеЗаполнено(ПараметрВыборПоВладельцу) И НЕ ПараметрВыборПоВладельцу.ЭтоГруппа Тогда
			Если НЕ ПараметрВыборПоВладельцу.ВестиУчетПоХарактеристикам Тогда
				Предупреждение("Для номенклатуры """ + ПараметрВыборПоВладельцу + """ не ведется учет по характеристикам!");
				Отказ = Истина;
			КонецЕсли;
		Иначе
			Предупреждение("Не выбрана номенклатура!");
			Отказ = Истина;
		КонецЕсли;
	КонецЕсли;	

КонецПроцедуры