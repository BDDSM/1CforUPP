Перем Периодичность;
Перем ЭталонныйСценарий;

////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ И ФУНКЦИИ ОБЩЕГО НАЗНАЧЕНИЯ

// Определяет максимальную из периодичностей сценариев, выбранных
// в ТЧ
//
// Параметры: нет
//
Процедура ОпределитьПериодичностьДанных()

	ТекущаяПериодичность=Перечисления.Периодичность.День;
	
	Для Каждого Строка Из ТаблицаСценарии Цикл
	
		Если НЕ Строка.Сценарий.Пустая() 
			И ОбщегоНазначения.ЧислоДнейВПериоде(Строка.Сценарий.Периодичность)>ОбщегоНазначения.ЧислоДнейВПериоде(ТекущаяПериодичность) Тогда
			ТекущаяПериодичность=Строка.Сценарий.Периодичность;
		КонецЕсли;
	
	КонецЦикла;
	
	Периодичность=ТекущаяПериодичность;
	
КонецПроцедуры // ОпределитьПериодичностьДанных()

///////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ ФОРМЫ

////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ ЭЛЕМЕНТОВ ДИАЛОГА

// Процедура - обработчик нажатия кнопки ОК.
//
Процедура ОсновныеДействияФормыОК(Кнопка)
	
	Закрыть(Истина);
	
КонецПроцедуры // ОсновныеДействияФормыОК()

// Процедура - обработчик перед удалением строки отбора
//
Процедура ОтборПередУдалением(Элемент, Отказ)
	
	Если Не ПустаяСтрока(Элемент.ТекущаяСтрока.Имя) Тогда
		Отказ = Истина;
	КонецЕсли; 
	
КонецПроцедуры // ОтборПередУдалением()

// Процедура - обработчик нажатия кнопки "Установить все" командной панели списка показателей
//
Процедура КоманднаяПанельСписокПоказателейУстановитьВсе(Кнопка)
	
	Для каждого Строка Из Показатели Цикл
		Строка.Использование = Истина;
	КонецЦикла;
		
КонецПроцедуры

// Процедура - обработчик нажатия кнопки "Снять все" командной панели списка показателей
//
Процедура КоманднаяПанельСписокПоказателейСнятьВсе(Кнопка)
	
	Для каждого Строка Из Показатели Цикл
		Строка.Использование = Ложь;
	КонецЦикла;
	
КонецПроцедуры

Процедура ТаблицаСценарииСценарийПриИзменении(Элемент)
	
	ОпределитьПериодичностьДанных();
	
	Для каждого Строка Из ТаблицаСценарии Цикл
	
		 Строка.ДатаКон=ОбщегоНазначения.ДатаКонцаПериода(?(Строка.ДатаКон='00010101',РабочаяДата,Строка.ДатаКон),Периодичность);
	
	КонецЦикла; 
				
КонецПроцедуры

Процедура ТаблицаСценарииДатаКонПриИзменении(Элемент)
	
	Элемент.Значение=ОбщегоНазначения.ДатаКонцаПериода(Элемент.Значение,Периодичность);
	
КонецПроцедуры

Процедура ТаблицаСценарииДатаКонРегулирование(Элемент, Направление, СтандартнаяОбработка)
	
	СтандартнаяОбработка=Ложь;

	Элемент.Значение=ОбщегоНазначения.ДатаКонцаПериода(ОбщегоНазначения.ДобавитьИнтервал(Элемент.Значение,Периодичность,Направление),Периодичность);
	
КонецПроцедуры

Процедура ТаблицаСценарииПриВыводеСтроки(Элемент, ОформлениеСтроки, ДанныеСтроки)
	
	// Первая строка выделяется жирным шрифтом
	Если ТаблицаСценарии.Индекс(ДанныеСтроки) = 0 Тогда
		ОформлениеСтроки.Шрифт = Новый Шрифт(ОформлениеСтроки.Шрифт, , , Истина, , , );
		
		Если НЕ ДанныеСтроки.Сценарий=ЭталонныйСценарий Тогда
			// Изменен порядок строк
			ЗаполнитьНачальныеНастройки();
			Оповестить("ИзмененыПараметрыНастройки",,ЭтаФорма);
			ЭталонныйСценарий=ДанныеСтроки.Сценарий;
		КонецЕсли;
			
	КонецЕсли;
	
	Если НЕ ДанныеСтроки.ВидДанных=Перечисления.ВидыДанныхДляОтчетовБюджетирования.Сценарий Тогда
		ОформлениеСтроки.Ячейки.Сценарий.ТолькоПросмотр=Истина;
	КонецЕсли;
	
КонецПроцедуры

Процедура ТаблицаСценарииПриОкончанииРедактирования(Элемент, НоваяСтрока, ОтменаРедактирования)
	
	Если НЕ ОтменаРедактирования И ЭлементыФормы.ТаблицаСценарии.ТекущиеДанные <> Неопределено Тогда
	
		ЭталонныйСценарий=ЭлементыФормы.ТаблицаСценарии.ТекущиеДанные.Сценарий;
		ОпределитьПериодичностьДанных();
		ЗаполнитьНачальныеНастройки();
		Оповестить("ИзмененыПараметрыНастройки",,ЭтаФорма);
	
	КонецЕсли; 
	
КонецПроцедуры

Процедура ПоказателиПриИзмененииФлажка(Элемент, Колонка)
	
	ЗаполнитьНачальныеНастройки();
	Оповестить("ИзмененыПараметрыНастройки",,ЭтаФорма);
	
КонецПроцедуры

Процедура ПередОткрытием(Отказ, СтандартнаяОбработка)
	
	Заголовок = "Настройка: " + мНазваниеОтчета;
	
КонецПроцедуры

Процедура ТаблицаСценарииВидДанныхПриИзменении(Элемент)
	
	Если НЕ Элемент.Значение=Перечисления.ВидыДанныхДляОтчетовБюджетирования.Сценарий Тогда
		ЭлементыФормы.ТаблицаСценарии.ТекущиеДанные.Сценарий=Справочники.СценарииПланирования.ПустаяСсылка();
	КонецЕсли;
	
КонецПроцедуры